<!doctype html><html lang=en><head><meta charset=utf-8><title>Hello! Bluemsun | Sa-token</title>
<meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=180x180 href=../../apple-touch-icon.jpg><link rel=icon type=image/png sizes=32x32 href=../../favicon-32x32.jpg><link rel=icon type=image/png sizes=16x16 href=../../favicon-16x16.jpg><link rel=manifest href=../../site.webmanifest><link href=../../css/fa6.min.css rel=stylesheet type=text/css><link rel=stylesheet href="/css/style.min.a01e3b937649f1605ced9b17b3d1b30e6ced44977842d39fd64158a666cf1a60.css"><link href=../../css/style.min.css rel=stylesheet type=text/css><link rel=stylesheet href=../../css/custom.css><link rel=stylesheet href=../../css/tokyo-night-dark.min.css><script src=https://unpkg.com/@tailwindcss/browser@4></script><meta property="og:title" content="Hello! Bluemsun | Sa-token"><meta name=description content="è½»é‡çº§Javaæƒé™è®¤è¯æ¡†æ¶"><meta property="og:title" content=" | "><meta property="og:site_name" content="Hello! Bluemsun"><meta property="og:description" content="è½»é‡çº§Javaæƒé™è®¤è¯æ¡†æ¶"><meta property="og:url" content="https://bluemsun.com.cn/blog/14zsq/"><meta property="og:type" content="article"><meta property="og:locale" content><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@tech_chiba"><link rel=canonical href=https://bluemsun.com.cn/blog/14zsq/><meta name=twitter:description content="è½»é‡çº§Javaæƒé™è®¤è¯æ¡†æ¶"><meta property="article:published_time" content="2024-10-08T10:02:51+08:00"><meta property="article:updated_time" content="2024-10-08T10:02:51+08:00"><meta property="og:image" content="https://bluemsun.com.cn/img/blog_pic/java.jpg"><meta name=twitter:title content="Sa-token"><link rel=preload href=../../css/sweetalert2.min.css as=style onload='this.onload=null,this.rel="stylesheet"'></head><body class="flex flex-col min-h-screen"><main class=flex-grow><header><div id=overlay><ul class="text-center list-none text-white text-3xl"><li class=p-2><a href=../../><span>ğŸ è¿”å›ä¸»é¡µ</span></a></li><li class=p-2><a href=../../products/><span>ğŸ’»é¡¹ç›®ä»‹ç»</span></a></li><li class=p-2><a href=../../blog/><span>ğŸ“„å¾€æœŸåšå®¢</span></a></li><li class=p-2><a href=../../news/><span>ğŸ“°æ–°é—»æ ç›®</span></a></li><li class=p-2><a href=../../about/><span>â˜€ï¸å…³äºè“æ—­</span></a></li><li class=p-2><a href=../../contact/><span>ğŸ˜†åŠ å…¥æˆ‘ä»¬</span></a></li></ul></div><nav class="flex items-center justify-between flex-wrap bg-opacity-80 p-4"><div class="flex items-center flex-shrink-0 text-xl text-grey-900 mr-6 flex-row"><a href=https://bluemsun.com.cn/ class="flex items-center flex-shrink-0 text-black mr-6"><img alt="Bluemsun Studio" class="lg:h-14 h-10" src=../../img/logo/logo.png><div><h1 class="px-2 text-4xl tracking-tighter text-balance max-lg:font-medium max-sm:px-4 sm:text-5xl lg:text-6xl xl:text-8xl">è“æ—­å·¥ä½œå®¤</h1><h2 class="px-2 text-xl tracking-tighter text-balance max-lg:font-medium max-sm:px-4 sm:text-3xl lg:text-4xl xl:text-6xl">Bluemsun Studio</h2></div></a></div><div class="block lg:hidden"><div id=hamburgerbtn class="flex cursor-pointer items-center w-6 h-6 py-2 rounded mopen"><span class=top></span>
<span class=middle></span>
<span class=bottom></span></div></div><div class="hidden w-full block flex-grow lg:flex lg:items-center lg:w-auto" id=mobileMenu><div class="text-lg lg:flex-grow"></div><div class=text-xl><a href=../../ class="duration-200 block mt-4 lg:inline-block lg:mt-0 text-black hover:opacity-60 mr-8 px-2 py-1 rounded">ğŸ è¿”å›ä¸»é¡µ
</a><a href=../../products/ class="duration-200 block mt-4 lg:inline-block lg:mt-0 text-black hover:opacity-60 mr-8 px-2 py-1 rounded">ğŸ’»é¡¹ç›®ä»‹ç»
</a><a href=../../blog/ class="duration-200 block mt-4 lg:inline-block lg:mt-0 text-black hover:opacity-60 mr-8 px-2 py-1 rounded">ğŸ“„å¾€æœŸåšå®¢
</a><a href=../../news/ class="duration-200 block mt-4 lg:inline-block lg:mt-0 text-black hover:opacity-60 mr-8 px-2 py-1 rounded">ğŸ“°æ–°é—»æ ç›®
</a><a href=../../about/ class="duration-200 block mt-4 lg:inline-block lg:mt-0 text-black hover:opacity-60 mr-8 px-2 py-1 rounded">â˜€ï¸å…³äºè“æ—­
</a><a href=../../contact/ class="duration-200 block mt-4 lg:inline-block lg:mt-0 text-black hover:opacity-60 mr-8 px-2 py-1 rounded">ğŸ˜†åŠ å…¥æˆ‘ä»¬</a></div></div></nav></header><div class="scroll-top rounded-full"><span class="icon-keyboard_arrow_up text-2xl"></span></div><div class="mx-auto my-10 max-w-6xl"><div class="mx-3 col-span-3 lg:col-span-2 px-2 bg-white p-8"><h1 class="title text-5xl font-bold h-fit mb-4 px-8"><i class="fa-solid fa-fan fa-spin" style=color:#2f6a58></i>
Sa-token</h1><section class="px-2 text-lg flex flex-row items-center"><h4 class="flex flex-row items-center p-1"><i class="fa-solid fa-pen-nib mr-2" style=color:#292929></i>
<span class=px-1>ä½œè€…</span>
å¼ ç»å¯</h4><div id=categories class="flex flex-row items-center p-1"><span class=px-1>æ”¶å½•äºç³»åˆ—</span>
<i class="fa-regular fa-folder-open mr-2" style=color:#63e6be></i>
<span class="inline-flex py-1 leading-4 content-center justify-center px-1 text-blue-600 hover:text-blue-800 duration-200"><a href=https://bluemsun.com.cn/categories/%E5%90%8E%E7%AB%AF>åç«¯</a></span></div></section><section class="px-2 text-lg flex flex-row items-center justify-between w-full"><div class="w-fit flex flex-row items-center"><h4 id=date class="flex flex-row items-center p-1"><i class="fa-solid fa-calendar-days"></i>
<span class=px-1>å‘å¸ƒæ—¶é—´</span>
2024/10/08</h4><h4 id=lastmod class="flex flex-row items-center p-1"><i class="fa-solid fa-calendar-edit"></i>
<span class=px-1>æœ€åæ›´æ–°äº</span>
2024/10/08</h4><h4 id=reading-time class="flex flex-row items-center p-1"><i class="fa-solid fa-hourglass-half"></i>
<span class=px-1>é¢„è®¡é˜…è¯»</span>3 åˆ†é’Ÿ</h4><h4 id=word-count class="flex flex-row items-center p-1"><i class="fa-solid fa-file-alt"></i>
<span class=px-1>æ–‡ç« å­—æ•°</span> 531 å­—</h4></div></section><div class="m-2 featured-image"><img class=my-4 sizes=auto height=auto width=auto src=https://bluemsun.com.cn/img/blog_pic/java.jpg></div><div class="content prose md:prose-lg lg:prose-xl max-w-none bg-white p-8 border-black" style="border:dashed 1px #ff4365"><h2 id=sa-tokenç®€ä»‹>Sa-tokenç®€ä»‹:</h2><p>SA-Tokenæ˜¯ä¸€ä¸ªè½»é‡çº§Javaæƒé™è®¤è¯æ¡†æ¶ï¼Œä¸»è¦è§£å†³ï¼šç™»å½•è®¤è¯ã€æƒé™è®¤è¯ã€Sessionä¼šè¯ã€å•ç‚¹ç™»å½•ã€OAuth2.0ç­‰åŠŸèƒ½ã€‚ä½ å¯ä»¥ä½¿ç”¨SA-Tokenæ¥è½»æ¾åœ°å®ç°é¡¹ç›®çš„æƒé™æ§åˆ¶ï¼Œå¹¶ä¸”å‡ ä¹é›¶å­¦ä¹ æˆæœ¬ã€‚SA-Tokenä»¥ç®€å•ã€æ˜“ç”¨ã€å®‰å…¨ä¸ºä¸»è¦è®¾è®¡ç›®æ ‡ï¼Œæä¾›äº†ä¸°å¯Œçš„APIå’Œçµæ´»çš„æ‰©å±•æœºåˆ¶ï¼Œå¯ä»¥æ»¡è¶³å¤§å¤šæ•°é¡¹ç›®çš„éœ€æ±‚ã€‚</p><p><img src=https://vichywhite.oss-cn-beijing.aliyuncs.com/zlz2023012957/202502271910370.png alt=img><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨>ç¼–è¾‘</p><h2 id=åŸºç¡€æµç¨‹å›¾>åŸºç¡€æµç¨‹å›¾:</h2><h2></h2><p><img src=https://vichywhite.oss-cn-beijing.aliyuncs.com/zlz2023012957/202502271910023.png alt=img><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨>ç¼–è¾‘</p><h2></h2><h2 id=å‚è€ƒèµ„æ–™>å‚è€ƒèµ„æ–™:</h2><p>å®˜æ–¹æ–‡æ¡£:<a href=https://sa-token.cc/index.html>Sa-Token</a></p><h2 id=ä¾èµ–>ä¾èµ–:</h2><pre tabindex=0><code>        åŸºæœ¬:
        &lt;dependency&gt;
            &lt;groupId&gt;cn.dev33&lt;/groupId&gt;
            &lt;artifactId&gt;sa-token-spring-boot3-starter&lt;/artifactId&gt;
            &lt;version&gt;1.39.0&lt;/version&gt;
        &lt;/dependency&gt;
 &lt;!-- Sa-Token æ•´åˆ Redis ï¼ˆä½¿ç”¨ jdk é»˜è®¤åºåˆ—åŒ–æ–¹å¼ï¼‰ --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;cn.dev33&lt;/groupId&gt;
            &lt;artifactId&gt;sa-token-redis&lt;/artifactId&gt;
            &lt;version&gt;1.39.0&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- æä¾›Redisè¿æ¥æ±  --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;
            &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- Sa-Token OAuth2.0 æ¨¡å— --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;cn.dev33&lt;/groupId&gt;
            &lt;artifactId&gt;sa-token-oauth2&lt;/artifactId&gt;
            &lt;version&gt;1.39.0&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨></p><h2 id=æ¡†æ¶é…ç½®>æ¡†æ¶é…ç½®:</h2><pre tabindex=0><code># Sa-Tokené…ç½®
sa-token:
  # tokenåç§° (åŒæ—¶ä¹Ÿæ˜¯cookieåç§°)
  token-name: xc_satoken
  # tokenæœ‰æ•ˆæœŸï¼Œå•ä½s é»˜è®¤30å¤©, -1ä»£è¡¨æ°¸ä¸è¿‡æœŸ
  timeout: 2592000
  # æ˜¯å¦å…è®¸åŒä¸€è´¦å·å¹¶å‘ç™»å½• (ä¸ºtrueæ—¶å…è®¸ä¸€èµ·ç™»å½•, ä¸ºfalseæ—¶æ–°ç™»å½•æŒ¤æ‰æ—§ç™»å½•)
  is-concurrent: true
  # åœ¨å¤šäººç™»å½•åŒä¸€è´¦å·æ—¶ï¼Œæ˜¯å¦å…±ç”¨ä¸€ä¸ªtoken (ä¸ºtrueæ—¶æ‰€æœ‰ç™»å½•å…±ç”¨ä¸€ä¸ªtoken, ä¸ºfalseæ—¶æ¯æ¬¡ç™»å½•æ–°å»ºä¸€ä¸ªtoken)
  is-share: false
  # tokené£æ ¼
  token-style: uuid
  # æ˜¯å¦è¾“å‡ºæ“ä½œæ—¥å¿—
  is-log: true
  # ä¸ä» Cookie ä¸­è¯»å– Token
  is-read-cookie: false
  # ä¸å°† Token å†™å…¥ Cookie
  is-write-cookie: false





    # redisé…ç½®
    redis:
      # Redisæ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤ä¸º0ï¼‰
      database: 1
      # RedisæœåŠ¡å™¨åœ°å€
      host: 127.0.0.1
      # RedisæœåŠ¡å™¨è¿æ¥ç«¯å£
      port: 6379
      # RedisæœåŠ¡å™¨è¿æ¥å¯†ç ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰
      # password:
      # è¿æ¥è¶…æ—¶æ—¶é—´
      timeout: 10s
      lettuce:
        pool:
          # è¿æ¥æ± æœ€å¤§è¿æ¥æ•°
          max-active: 200
          # è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰
          max-wait: -1ms
          # è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥
          max-idle: 10
          # è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥
          min-idle: 0
</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨></p><h2 id=å…¨å±€å¼‚å¸¸å¤„ç†>å…¨å±€å¼‚å¸¸å¤„ç†:</h2><p>åœ¨ä½¿ç”¨æ¡†æ¶æ—¶å€™å‡ºç°çš„å¼‚å¸¸ä»–éƒ½å†™å¥½äº†å¼‚å¸¸ç±»ï¼Œæˆ‘ä»¬ç›´æ¥å¤„ç†å°±å¯ä»¥äº†</p><pre tabindex=0><code>package com.pj.current;

import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;

import cn.dev33.satoken.exception.DisableServiceException;
import cn.dev33.satoken.exception.NotHttpBasicAuthException;
import cn.dev33.satoken.exception.NotLoginException;
import cn.dev33.satoken.exception.NotPermissionException;
import cn.dev33.satoken.exception.NotRoleException;
import cn.dev33.satoken.exception.NotSafeException;
import cn.dev33.satoken.util.SaResult;

/**
 * å…¨å±€å¼‚å¸¸å¤„ç† 
 */
@RestControllerAdvice
public class GlobalException {

	// æ‹¦æˆªï¼šæœªç™»å½•å¼‚å¸¸
	@ExceptionHandler(NotLoginException.class)
	public SaResult handlerException(NotLoginException e) {

		// æ‰“å°å †æ ˆï¼Œä»¥ä¾›è°ƒè¯•
		e.printStackTrace(); 

		// è¿”å›ç»™å‰ç«¯
		return SaResult.error(e.getMessage());
	}

	// æ‹¦æˆªï¼šç¼ºå°‘æƒé™å¼‚å¸¸
	@ExceptionHandler(NotPermissionException.class)
	public SaResult handlerException(NotPermissionException e) {
		e.printStackTrace(); 
		return SaResult.error(&#34;ç¼ºå°‘æƒé™ï¼š&#34; + e.getPermission());
	}

	// æ‹¦æˆªï¼šç¼ºå°‘è§’è‰²å¼‚å¸¸
	@ExceptionHandler(NotRoleException.class)
	public SaResult handlerException(NotRoleException e) {
		e.printStackTrace(); 
		return SaResult.error(&#34;ç¼ºå°‘è§’è‰²ï¼š&#34; + e.getRole());
	}

	// æ‹¦æˆªï¼šäºŒçº§è®¤è¯æ ¡éªŒå¤±è´¥å¼‚å¸¸
	@ExceptionHandler(NotSafeException.class)
	public SaResult handlerException(NotSafeException e) {
		e.printStackTrace(); 
		return SaResult.error(&#34;äºŒçº§è®¤è¯æ ¡éªŒå¤±è´¥ï¼š&#34; + e.getService());
	}

	// æ‹¦æˆªï¼šæœåŠ¡å°ç¦å¼‚å¸¸ 
	@ExceptionHandler(DisableServiceException.class)
	public SaResult handlerException(DisableServiceException e) {
		e.printStackTrace(); 
		return SaResult.error(&#34;å½“å‰è´¦å· &#34; + e.getService() + &#34; æœåŠ¡å·²è¢«å°ç¦ (level=&#34; + e.getLevel() + &#34;)ï¼š&#34; + e.getDisableTime() + &#34;ç§’åè§£å°&#34;);
	}

	// æ‹¦æˆªï¼šHttp Basic æ ¡éªŒå¤±è´¥å¼‚å¸¸ 
	@ExceptionHandler(NotHttpBasicAuthException.class)
	public SaResult handlerException(NotHttpBasicAuthException e) {
		e.printStackTrace(); 
		return SaResult.error(e.getMessage());
	}

	// æ‹¦æˆªï¼šå…¶å®ƒæ‰€æœ‰å¼‚å¸¸
	@ExceptionHandler(Exception.class)
	public SaResult handlerException(Exception e) {
		e.printStackTrace(); 
		return SaResult.error(e.getMessage());
	}
	
}
</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨></p><h2 id=åŸºç¡€æ–¹æ³•>åŸºç¡€æ–¹æ³•:</h2><p>satokenæä¾›çš„ç›¸å…³æ–¹æ³•:</p><p>ç™»å½•æ–¹æ³•:</p><pre tabindex=0><code>StpUtil.login(userId);
</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨></p><p>è°ƒç”¨æ–¹æ³•åï¼ŒæœåŠ¡ç«¯ä¼šåˆ›å»ºsessionï¼Œsessionç”¨ç”¨æˆ·idæ¥æ ‡è®°ï¼Œsessionå­˜å‚¨ä¼šè¯ç›¸å…³çš„ä¿¡æ¯ï¼Œç”Ÿæˆtoken,å¦‚æœå¼€å¯ç¼“å­˜ä¼šå°†ä¿¡æ¯å­˜å‚¨åˆ°redisä¸­</p><p><img src=https://vichywhite.oss-cn-beijing.aliyuncs.com/zlz2023012957/202502271910966.png alt=img><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨>ç¼–è¾‘</p><p>åˆ¤æ–­æ˜¯å¦ç™»å½•çš„æ–¹æ³•:</p><pre tabindex=0><code>StpUtil.checkLogin():

StpUtil.isLogin();
</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨></p><p>é€šè¿‡è¯·æ±‚å¤´ä¸­çš„tokenNameä¸­çš„tokenValueæ¥è·å–userIdï¼Œå†å»sessionä¸­æ‰¾æœ‰æ— å¯¹åº”çš„ä¼šè¯è®°å½•</p><p>è¿™ä¸¤ä¸ªæ–¹æ³•çš„åŒºåˆ«åœ¨äºç¬¬ä¸€ä¸ªæ–¹æ³•ä¼šæŠ›å‡ºå¼‚å¸¸.</p><p>//æˆ‘ç¦ç”¨äº†ç¼“å­˜ï¼Œæˆ‘è®²ä»¤ç‰Œæ·»åŠ åˆ°è¯·æ±‚å¤´ï¼Œè°ƒç”¨éœ€è¦ç™»å½•éªŒè¯çš„æ¥å£,å¯ä»¥éªŒè¯ç™»å½•æˆåŠŸï¼Œä½†æ˜¯æˆ‘é‡å¯æœåŠ¡å™¨ä»¥åç™»å½•å°±å¤±è´¥äº†ï¼Œæˆ‘æ„Ÿè§‰satoeknåœ¨æœåŠ¡ç«¯çš„sessionä¸­ä¿å­˜äº†ä¼šè¯ä¿¡æ¯ã€‚</p><p>é€€å‡ºæ–¹æ³•:</p><pre tabindex=0><code>StpUtil.logout(userId);
</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨></p><p>ä¼šå°†ç¼“å­˜ä¸­çš„ä¼šè¯ä¿¡æ¯è¿˜æœ‰ä»¤ç‰Œå…¨éƒ½åˆ é™¤ã€‚</p><p>ä¸ç”¨æˆ·ä¼šè¯ä¿¡æ¯ç›¸å…³çš„æ–¹æ³•:</p><pre tabindex=0><code>StpUtil.getLoginId();// è·å–å½“å‰ä¼šè¯è´¦å·id, å¦‚æœæœªç™»å½•ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼š`NotLoginException`
StpUtil.getLoginIdAsString();    // è·å–å½“å‰ä¼šè¯è´¦å·id, å¹¶è½¬åŒ–ä¸º`String`ç±»å‹
StpUtil.getLoginIdAsInt();       // è·å–å½“å‰ä¼šè¯è´¦å·id, å¹¶è½¬åŒ–ä¸º`int`ç±»å‹
StpUtil.getLoginIdAsLong();      // è·å–å½“å‰ä¼šè¯è´¦å·id, å¹¶è½¬åŒ–ä¸º`long`ç±»å‹



// è·å–å½“å‰ä¼šè¯çš„ token å€¼
StpUtil.getTokenValue();

// è·å–å½“å‰`StpLogic`çš„ token åç§°
StpUtil.getTokenName();

// è·å–æŒ‡å®š token å¯¹åº”çš„è´¦å·idï¼Œå¦‚æœæœªç™»å½•ï¼Œåˆ™è¿”å› null
StpUtil.getLoginIdByToken(String tokenValue);

// è·å–å½“å‰ä¼šè¯å‰©ä½™æœ‰æ•ˆæœŸï¼ˆå•ä½ï¼šsï¼Œè¿”å›-1ä»£è¡¨æ°¸ä¹…æœ‰æ•ˆï¼‰
StpUtil.getTokenTimeout();

// è·å–å½“å‰ä¼šè¯çš„ token ä¿¡æ¯å‚æ•°
StpUtil.getTokenInfo();
</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨></p><p>é€šè¿‡sasessionæ¥è·å–ä¼šè¯ä¸­çš„è¯¦ç»†æ•°æ®ã€‚</p><p>è¸¢äººä¸‹çº¿:</p><pre tabindex=0><code>StpUtil.kickout(id);
</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨></p><p>å°†æŒ‡å®šç”¨æˆ·çš„sessionè®°å½•åˆ é™¤ã€‚</p><h2 id=è¸¢äººä¸‹çº¿å¼ºåˆ¶æ³¨é”€>è¸¢äººä¸‹çº¿ï¼Œå¼ºåˆ¶æ³¨é”€:</h2><ol><li><p><strong>è¸¢äººä¸‹çº¿</strong>ï¼š</p><ul><li><strong>æ„å›¾</strong>ï¼šé€šå¸¸æ˜¯å‡ºäºç®¡ç†éœ€è¦ï¼Œå¯èƒ½æ˜¯ç®¡ç†å‘˜ä¸»åŠ¨å†³å®šè®©æŸä¸ªç”¨æˆ·ä¸‹çº¿ã€‚</li><li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šç”¨æˆ·ä¼šæ”¶åˆ°é€šçŸ¥ï¼Œå‘ŠçŸ¥ä»–ä»¬å·²è¢«è¸¢ä¸‹çº¿ï¼Œé€šå¸¸ä¼šæœ‰æ˜ç¡®çš„æç¤ºï¼Œå…è®¸ä»–ä»¬é‡æ–°ç™»å½•.</li></ul></li><li><p><strong>å¼ºåˆ¶æ³¨é”€</strong>ï¼š</p><ul><li><strong>æ„å›¾</strong>ï¼šé€šå¸¸æ˜¯å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œä¾‹å¦‚æ£€æµ‹åˆ°å¼‚å¸¸æ´»åŠ¨æˆ–è´¦æˆ·è¢«ç›—ç”¨ã€‚</li><li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šç”¨æˆ·å¯èƒ½åœ¨å°è¯•è®¿é—®èµ„æºæ—¶ç›´æ¥è¢«æ‹’ç»ï¼Œé€šå¸¸æ²¡æœ‰æå‰çš„æç¤ºï¼Œå¯èƒ½ä¼šæ„Ÿåˆ°å›°æƒ‘ã€‚</li></ul></li></ol><h2 id=imgç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨ç¼–è¾‘><img src=https://vichywhite.oss-cn-beijing.aliyuncs.com/zlz2023012957/202502271910028.gif alt=img><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨>ç¼–è¾‘</h2><h2></h2><h2 id=æƒé™è®¤è¯>æƒé™è®¤è¯:</h2><p>åœ¨è®²æƒé™è®¤è¯ä»¥å‰å…ˆäº†è§£ä¸€ä¸‹RBACæ¨¡å‹:</p><h3 id=rbacæ¨¡å‹>RBACæ¨¡å‹ï¼š</h3><p>å‚è€ƒè¿æ¥:</p><p><a href="https://blog.csdn.net/m0_62006803/article/details/133962328?ops_request_misc=%7B%22request%5Fid%22%3A%2298D9C6AF-D3C3-481A-B421-94E565EEC0E0%22%2C%22scm%22%3A%2220140713.130102334..%22%7D&amp;request_id=98D9C6AF-D3C3-481A-B421-94E565EEC0E0&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-133962328-null-null.142%5Ev100%5Epc_search_result_base3&amp;utm_term=RBAC&amp;spm=1018.2226.3001.4187">RBACâ€”â€”åŸºäºè§’è‰²æƒé™çš„æ¨¡å‹-CSDNåšå®¢</a></p><h3 id=æµç¨‹>æµç¨‹:</h3><p>æ ¹æ®RBACæ¨¡å‹åˆ›å»ºè¡¨å•:
<img src=https://vichywhite.oss-cn-beijing.aliyuncs.com/zlz2023012957/202502271910863.png alt=img><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨>â€‹ç¼–è¾‘</p><p>å®ç°æ¥å£:</p><p>1:å®ç°æ ¹æ®userIdè·å–ç”¨æˆ·è§’è‰²å’Œç”¨æˆ·æƒé™çš„æ¥å£</p><pre tabindex=0><code>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;
&lt;!DOCTYPE mapper PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;
        &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34; &gt;
&lt;mapper namespace=&#34;com.example.demo.mapper.RoleUserMapper&#34;&gt;
    &lt;!-- è·å–ç”¨æˆ·çš„è§’è‰²åˆ—è¡¨ --&gt;
    &lt;select id=&#34;getRoleList&#34; resultType=&#34;String&#34;&gt;
        SELECT r.role_name
        FROM role_user ru
                 INNER JOIN role r ON ru.role_id = r.id
        WHERE ru.user_id = #{userId}
    &lt;/select&gt;
&lt;/mapper&gt;
</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨></p><pre tabindex=0><code>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;
&lt;!DOCTYPE mapper PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;
        &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34; &gt;
&lt;mapper namespace=&#34;com.example.demo.mapper.RolePermissionMapper&#34;&gt;
    &lt;!-- è·å–ç”¨æˆ·çš„æ‰€æœ‰æƒé™åç§° --&gt;
    &lt;select id=&#34;getPermissionList&#34; resultType=&#34;String&#34;&gt;
        SELECT p.permission_name
        FROM role_user ru
                 INNER JOIN role r ON ru.role_id = r.id
                 INNER JOIN role_permission rp ON r.id = rp.role_id
                 INNER JOIN permission p ON rp.permission_id = p.id
        WHERE ru.user_id = #{userId}
    &lt;/select&gt;
&lt;/mapper&gt;
</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨></p><p>2:å®ç°satokençš„é‰´æƒçš„æ¥å£:</p><p>åœ¨è°ƒç”¨checkRoleæ—¶å€™ä¼šè°ƒç”¨getRoleList,å¹¶ä¸”æ£€æŸ¥listé‡Œæ˜¯å¦æœ‰æ–¹æ³•éœ€è¦çš„è§’è‰²ä¿¡æ¯</p><p>åœ¨è°ƒç”¨checkPermissionæ—¶å€™ä¼šè°ƒç”¨getPermissionListï¼Œå¹¶ä¸”æ£€æŸ¥listé‡Œæ˜¯å¦æœ‰æ–¹æ³•éœ€è¦çš„è§’è‰²æƒé™</p><p><img src=https://vichywhite.oss-cn-beijing.aliyuncs.com/zlz2023012957/202502271910260.png alt=img><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨>ç¼–è¾‘</p><p>æ–¹æ³•ä¸­çš„å‚æ•°:</p><p>o:è¿™ä¸ªå‚æ•°é€šå¸¸ç”¨æ¥ä»£è¡¨å½“å‰ç”¨æˆ·çš„èº«ä»½æˆ–ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒå¯èƒ½æ˜¯ç”¨æˆ·å¯¹è±¡çš„å¼•ç”¨ï¼Œä¾‹å¦‚ç”¨æˆ·IDæˆ–ç”¨æˆ·çš„å…¶ä»–ç‰¹å¾ã€‚è¿™ä¸ªå‚æ•°çš„ç±»å‹æ˜¯ <code>Object</code>ï¼Œæ„å‘³ç€å®ƒå¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„å¯¹è±¡ï¼Œå…·ä½“å«ä¹‰ä¾èµ–äºå®ç°çš„ä¸Šä¸‹æ–‡å’Œä½¿ç”¨çš„æ¡†æ¶ã€‚é€šå¸¸æ˜¯ç”¨æˆ·id</p><p>s:è¿™ä¸ªå‚æ•°ç»å¸¸ç”¨äºè¡¨ç¤ºé¢å¤–çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä¾‹å¦‚è¯·æ±‚çš„èµ„æºã€æ“ä½œç±»å‹æˆ–è§’è‰²åç§°ç­‰ã€‚è¿™ä¸ªå­—ç¬¦ä¸²çš„å…·ä½“å«ä¹‰å–å†³äºä¸šåŠ¡é€»è¾‘å’Œåº”ç”¨ç¨‹åºçš„éœ€æ±‚ã€‚é€šå¸¸æ˜¯çŠ¶æ€å¦‚login</p><p><img src=https://i-blog.csdnimg.cn/direct/5eddedff3bc74bada3b8133409bf1cf6.png alt=img><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨>ç¼–è¾‘</p><p>æ³¨è§£é‰´æƒ:</p><p>åœ¨æ¥å£ä¸Šæ·»åŠ æ³¨è§£å³å¯ï¼š</p><p><img src=https://i-blog.csdnimg.cn/direct/bc86de9ff3724af1887325842f6089ac.png alt=img><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨>ç¼–è¾‘</p><p>å½“æœ‰å¤šä¸ªæƒé™æˆ–è€…è§’è‰²æ—¶å€™:</p><p><img src=https://vichywhite.oss-cn-beijing.aliyuncs.com/zlz2023012957/202502271910910.png alt=img><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨>ç¼–è¾‘</p><p>å½“æ—¢æœ‰è§’è‰²åˆæœ‰æƒé™è¦æ±‚æ—¶å€™:</p><p><img src=https://vichywhite.oss-cn-beijing.aliyuncs.com/zlz2023012957/202502271910757.png alt=img><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨>ç¼–è¾‘</p><p>æ‰¹é‡æ³¨è§£:</p><p><img src=https://vichywhite.oss-cn-beijing.aliyuncs.com/zlz2023012957/202502271910618.png alt=img><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨>ç¼–è¾‘</p><p>æ·»åŠ çš„æ³¨è§£è¿˜å¯ä»¥è‡ªå®šä¹‰å®ç°:<a href=https://sa-token.cc/doc.html#/fun/custom-annotations>è‡ªå®šä¹‰æ³¨è§£ (sa-token.cc)</a></p><p>åœ¨ä¸šåŠ¡å±‚å®ç°æƒé™æ ¡éªŒ:<a href=https://sa-token.cc/doc.html#/plugin/aop-at>AOPæ³¨è§£é‰´æƒ (sa-token.cc)</a></p><p>æ‹¦æˆªå™¨é‰´æƒ:</p><pre tabindex=0><code>package com.example.demo.config;

import cn.dev33.satoken.SaManager;
import cn.dev33.satoken.context.SaHolder;
import cn.dev33.satoken.filter.SaServletFilter;
import cn.dev33.satoken.interceptor.SaInterceptor;
import cn.dev33.satoken.router.SaHttpMethod;
import cn.dev33.satoken.router.SaRouter;
import cn.dev33.satoken.stp.StpUtil;
import cn.dev33.satoken.util.SaResult;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class SaTokenConfigure implements WebMvcConfigurer {


    //å¯ç”¨æ³¨è§£æ¨¡å¼ï¼Œå¹¶ä¸”æ‹¦æˆª
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        System.out.println(&#34;å¯ç”¨æ³¨è§£æ¨¡å¼ï¼Œå¹¶ä¸”æ‹¦æˆª&#34;);
        registry.addInterceptor(new SaInterceptor(handle -&gt; StpUtil.checkLogin()))//ç›¸å½“äºåœ¨æ¯ä¸ªæ¥å£ä¸Šéƒ½å†™ä¸€ä¸ªcheckloginçš„æ³¨è§£
                .addPathPatterns(&#34;/**&#34;)//æ‹¦æˆªæ‰€æœ‰è¯·æ±‚
                .excludePathPatterns(&#34;/sa/login&#34;, &#34;/sa/register&#34;,&#34;/callback&#34;,&#34;/gitee/auth&#34;);//æ’é™¤ç™»å½•æ³¨å†Œè¯·æ±‚
    }


    
}
</code></pre><p><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨></p><p>åœ¨handleå¤„æ·»åŠ ä½ æƒ³è¦çš„é‰´æƒæ–¹æ³•ã€‚</p><h2 id=æ‰©å±•>æ‰©å±•ï¼š</h2><p>é›†æˆredisï¼šåªéœ€è¦æ·»åŠ ç›¸åº”çš„ä¾èµ–ï¼Œè¿˜æœ‰é…ç½®redisçš„æ–‡ä»¶ã€‚</p><p>é›†æˆjwt:æ·»åŠ ç›¸åº”çš„ä¾èµ–</p><p>å†æ›´æ”¹ä¸€ä¸‹é…ç½®</p><p><img src=https://vichywhite.oss-cn-beijing.aliyuncs.com/zlz2023012957/202502271910767.png alt=img><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨>ç¼–è¾‘</p><p><img src=https://vichywhite.oss-cn-beijing.aliyuncs.com/zlz2023012957/202502271911031.png alt=img><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨>ç¼–è¾‘</p><p>å…¨å±€æ—¥å¿—è¾“å‡º:</p><p><img src=https://vichywhite.oss-cn-beijing.aliyuncs.com/zlz2023012957/202502271911328.png alt=img><img src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt=ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨>ç¼–è¾‘</p></div><div class="share m-2 grid grid-cols-2 lg:grid-cols-3 gap-2"><a href="https://connect.qq.com/widget/shareqq/index.html?url=https%3a%2f%2fbluemsun.com.cn%2fblog%2f14zsq%2f&title=Sa-token&" target=_blank title=weibo class="share-button qq"><div class="text-white text-center"><i class="fa-brands fa-qq"></i> åˆ†äº«åˆ°QQ</div></a><a href="https://service.weibo.com/share/share.php?url=https%3a%2f%2fbluemsun.com.cn%2fblog%2f14zsq%2f&title=Sa-token&pic=https%3a%2f%2fbluemsun.com.cn%2fimg%2fblog_pic%2fjava.jpg" target=_blank title=weibo class="share-button weibo"><div class="text-white text-center"><i class="fa-brands fa-weibo"></i> åˆ†äº«åˆ°å¾®åš</div></a><a href=javascript:OnClickURL(); class="share-button url" title="Copy to Clipboard" data-clipboard-text="Sa-token https://bluemsun.com.cn/blog/14zsq/" id=url><div class="text-white text-center"><span class="icon-link text-lg mr-2"></span>å¤åˆ¶é“¾æ¥</div></a></div><hr class=py-4><aside id=meta><div class="grid grid-cols-2"><div class=col-span-1><a class="previous lg:text-2xl" href=https://bluemsun.com.cn/blog/10zgs2/><div class="transition-colors duration-300 border border-gray-600 hover:border-black h-auto m-3 text-center py-3 lg:py-1"><span class=icon-keyboard_arrow_left></span> 2024æ˜¥å­£è“æ—­å·¥ä½œâ€¦</div></a></div><a class="next lg:text-2xl" href=https://bluemsun.com.cn/blog/6gjt/><div class="transition-colors duration-300 col-span-1 border border-gray-600 hover:border-black h-auto m-3 text-center py-3 lg:py-1">javaå¼‚å¸¸ç±» <span class=icon-keyboard_arrow_right></span></div></a></div></aside></div><script src=https://giscus.app/client.js data-repo=BluemsunOffice/BluemsunOffice.github.io data-repo-id=R_kgDON_oJvQ data-category=Announcements data-category-id=DIC_kwDON_oJvc4CndFP data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></div></main><footer class=bg-tlgray-100><script src=../../js/clipboard.min.js></script><script src=../../js/highlight.min.js></script><script src=../../js/sweetalert2.min.js></script><script>hljs.initHighlightingOnLoad(),hljs.initLineNumbersOnLoad(),new ClipboardJS(".url");function OnClickURL(){Swal.fire({icon:"success",title:"Copied!",text:"Copied the URL and title."})}</script><script>function toggleNav(){var e=document.getElementById("hamburgerbtn"),t=document.getElementById("overlay"),n=document.body;e.addEventListener("click",function(){t.classList.toggle("open"),e.classList.toggle("is-open"),n.classList.toggle("scroll-lock")})}toggleNav(),document.querySelector(".scroll-top").addEventListener("click",()=>{document.documentElement.scrollTop=0})</script><link href="https://fonts.googleapis.com/css2?family=Montserrat&family=Open+Sans&display=swap" rel=stylesheet><div class="flex items-center justify-between flex-wrap bg-gray-800 p-8 text-white"><div class="items-center text-xl text-grey-900 mr-6 flex flex-row"><img alt="Bluemsun Studio" class="lg:h-14 h-10 mr-8" src=../../img/logo/logo.png><div><h1 class="px-2 text-3xl tracking-tighter text-balance max-lg:font-medium max-sm:px-4 sm:text-5xl lg:text-6xl xl:text-8xl">è“æ—­å·¥ä½œå®¤</h1><h2 class="px-2 text-xl tracking-tighter text-balance max-lg:font-medium max-sm:px-4 sm:text-3xl lg:text-4xl xl:text-6xl">Bluemsun Studio</h2></div></div><div class="w-full block flex-grow lg:flex lg:items-center lg:w-auto" id=mobileMenu><div class="text-lg lg:flex-grow"></div><div class="flex flex-row items-center text-lg"><a href=https://github.com/BluemsunOffice class="block mt-4 lg:inline-block lg:mt-0 text-gray-300 hover:text-white mr-8"><i class='icon-github text-2xl'></i></a></div></div></div><div class="copy pl-8 py-5 bg-tlgray-700 text-white text-md w-full text-center">&copy; Hello! Bluemsun 2025 All Rights Reserved.<br><span class=icp><p class=beian>æµ™ICPå¤‡2024119634å·</p></span><script async src=https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><span class=post-meta-item id=busuanzi_container_site_pv style=display:inline><span class=post-meta-item-icon><i class="fa fa-eye"></i></span>
<span class=site-pv title=æ€»è®¿é—®é‡><span id=busuanzi_value_site_pv></span></span></span></div></footer></body></html>